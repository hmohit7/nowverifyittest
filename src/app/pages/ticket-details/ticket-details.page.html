<ion-header no-border>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button [routerLink]="['/create-ticket']" [queryParams]="{ticketId: ticket._id}">
        edit
      </ion-button>
    </ion-buttons>
    <ion-title class="center-text">
      Ticket #{{ticket.uid}}
    </ion-title>
  </ion-toolbar>
  <div>
    <ion-segment scrollable class=" shadow margin-padding-zero " [(ngModel)]="selectedTab">
      <ion-segment-button class="margin-padding-zero font-12" value="SUMMARY">
        <ion-label class="margin-padding-zero">SUMMARY</ion-label>
      </ion-segment-button>
      <ion-segment-button class="font-12 " value="ASSETS">
        <ion-label class="margin-padding-zero">ASSETS</ion-label>
      </ion-segment-button>
      <ion-segment-button class="font-12" value="COMMENTS" (click)="getTicketComments()">
        <ion-label>COMMENTS</ion-label>
      </ion-segment-button>
      <ion-segment-button class="margin-padding-zero font-12" value="CHECKLIST">
        <ion-label>CHECKLIST</ion-label>
      </ion-segment-button>
      <ion-segment-button class="font-12" value="QUOTATIONS">
        <ion-label>QUOTATIONS</ion-label>
      </ion-segment-button>
      <ion-segment-button class="font-12" value="MATERIALS">
        <ion-label>MATERIALS</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>
</ion-header>

<ion-content>

  <div [ngSwitch]="selectedTab">

    <div *ngSwitchCase="'SUMMARY'">
      <div class="ticket-details-card">
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey margin-padding-zero font-14 gotham-medium margin-bottom-3">CATEGORY</p>
            <P class="gotham-medium margin-top-10 font-14 dark-grey">{{ticket.ticketCategory}}</P>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey margin-padding-zero gotham-medium font-14 margin-bottom-3">SUB CATEGORY</p>
            <P class="gotham-medium margin-top-10 font-14 dark-grey">{{ticket.ticketSubCategory}}</P>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey margin-padding-zero font-14 gotham-medium margin-bottom-3">CREATED ON</p>
            <p class="gotham-medium margin-top-10 font-14 dark-grey">
              {{ticket.createdAt | date:'dd MMM yyyy' }}</p>
          </ion-col>
          <ion-col>
            <p class="txt-slate-grey margin-padding-zero font-14 gotham-medium margin-bottom-3">DUE DATE</p>
            <p class="gotham-medium margin-top-10 font-14 dark-grey">
              {{ticket.deadlineDate | date:'dd MMM yyyy'}}</p>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey margin-padding-zero font-14 gotham-medium margin-bottom-3">DESCRIPTION</p>
            <p class="gotham-medium margin-top-10 font-14 dark-grey">
              {{ticket.notes}}</p>
            <p class="gotham-medium margin-top-10 font-14 dark-grey" [hidden]="ticket.notes">Ticket
              description not available</p>
          </ion-col>
        </ion-row>
        <ion-row>
          <!-- <ion-col>
            <p class="txt-slate-grey margin-padding-zero font-14 gotham-medium margin-bottom-3">LOCATION</p>
            <p class="gotham-medium margin-top-10 font-14 dark-grey">
              <span class="gotham-medium ">{{address.block}}</span>
              <span class=" gotham-medium ">{{address.door}}</span>
              {{address.name}}
            </p>
          </ion-col> -->
          <ion-col>
            <p class="txt-slate-grey font-14 margin-padding-zero gotham-medium margin-bottom-3">PRIORITY</p>
            <p class="gotham-medium margin-top-10 font-14 dark-grey">{{ticket.priority}}</p>
          </ion-col>
        </ion-row>
      </div>

      <div class="ticket-details-card dark-grey">
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium">PEOPLE</p>
          </ion-col>
        </ion-row>

        <ion-row class="margin-bottom-10">
          <ion-col size="2">
            <ngx-avatar initialsSize="2" textSizeRatio="2" name="{{ticket.raisedBy?.firstName}}"></ngx-avatar>
          </ion-col>
          <ion-col class="margin-left-10">
            <p class="gotham-medium font-14 dark-grey margin-padding-zero">Raised by</p>
            <p *ngIf="ticket.raisedBy"
              class="txt-warm-grey font-14 gotham-medium font-weight-500 margin-top-8 txt-nowrap">
              {{ticket.raisedBy.firstName}} {{ticket.raisedBy.lastName}}
            </p>
            <!-- <p class="txt-warm-grey font-14 gotham-medium font-weight-500 margin-padding-zero">Click here to add</p> -->
          </ion-col>
          <ion-col class="center-text ">
            <img class="float-right icon-25" src="/assets/icon/phone.png">
          </ion-col>
        </ion-row>

        <ion-row class=" margin-bottom-10">
          <ion-col size="2">
            <ngx-avatar textSizeRatio="2" initialsSize="2" name="{{ticket.contactPoint?.firstName}}"></ngx-avatar>
          </ion-col>
          <ion-col class="margin-left-10">
            <p class="gotham-medium font-14 dark-grey margin-padding-zero">Point Of contact</p>
            <p *ngIf="ticket.contactPoint"
              class="txt-warm-grey font-14 gotham-medium font-weight-500 margin-top-8 txt-nowrap">
              {{ticket.contactPoint.firstName}} {{ticket.contactPoint.lastName}}
              <span class="float-right font-14 txt-warm-grey gotham-medium font-weight-500"
                (click)="openUserSearchModal('poc')">Change</span>
            </p>
            <p *ngIf="!ticket.contactPoint"
              class="txt-warm-grey gotham-medium font-14 font-weight-500 margin-top-8 txt-nowrap">
              Not added
              <span class="float-right font-14 txt-warm-grey gotham-medium font-weight-500"
                (click)="openUserSearchModal('poc')">Add</span>
            </p>
          </ion-col>
        </ion-row>

        <ion-row class=" margin-bottom-10">
          <ion-col size="2" class="padding-right-20">
            <ngx-avatar initialsSize="2" textSizeRatio="2" class="margin-padding-zero font-14"
              name="{{ticket.agent?.firstName}}">
              <div class="margin-padding-zero"></div>
            </ngx-avatar>
          </ion-col>
          <ion-col class="margin-left-10">
            <p class="gotham-medium font-14 dark-grey margin-padding-zero">Technician</p>
            <p *ngIf="ticket.agent" class="txt-warm-grey font-14 gotham-medium font-weight-500 margin-top-8 txt-nowrap">
              {{ticket.agent.firstName}} {{ticket.agent.lastName}}
              <span class="float-right font-14 txt-warm-grey gotham-medium font-weight-500"
                (click)="openUserSearchModal('agent')">Change</span>
            </p>
            <p *ngIf="!ticket.agent"
              class="txt-warm-grey font-14 gotham-medium font-weight-500 margin-top-8 txt-nowrap">
              Not added
              <span class="float-right font-14 txt-warm-grey gotham-medium font-weight-500"
                (click)="openUserSearchModal('agent')">Add</span>
            </p>
          </ion-col>
        </ion-row>
      </div>

      <div class="ticket-details-card">
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium margin-bottom-3">PHOTOS</p>
          </ion-col>
        </ion-row>
        <ion-row style="flex-wrap: wrap;">

          <ion-col size="3" style="position: relative;" *ngFor="let file of ticket.files">
            <img src="assets/icon/delete.png"
              style="height: 25px; width: 25px; position: absolute; right: 6px; top: 6px;"
              (click)="removeImage(file._id)">
            <img src="file.aws_url" class="img-responsive height-70 border-radius-10 " />
          </ion-col>

          <ion-col size="3" class="center-text" (click)="fileSourceOption()">
            <img src="assets/icon/add-green.png" class="height-30 width-30 border-radius-10 " />
            <p class="txt-slate-grey gotham-medium margin-top-10 font-weight-500 font-14">
              Add photo</p>
          </ion-col>

        </ion-row>
        <div class="font-14 txt-brown center-text" *ngIf="ticket.files?.length == 0||images.length!>1">
          No pictures attached to this ticket
        </div>
      </div>

      <div class="ticket-details-card">
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey gotham-medium font-14 margin-bottom-10  ">JOB DETAILS</p>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium margin-padding-zero">JOB START DATE</p>
            <p *ngIf="ticket.jobDate" class="gotham-medium dark-grey font-14 margin-top-10 margin-bottom-3">
              {{ticket.jobDate | date:'dd MMM yyyy'}}</p>
            <span *ngIf="!ticket.jobDate" class="txt-warm-grey font-14 gotham-medium font-weight-500">Add</span>
          </ion-col>
          <ion-col>
            <p class="txt-slate-grey gotham-medium font-14 margin-padding-zero">TIME</p>
            <p *ngIf="ticket.jobStartTime" class="gotham-medium dark-grey margin-top-10 font-14 margin-bottom-3">
              {{ticket.jobStartTime | date:'hh:mm a'}}</p>
            <span *ngIf="!ticket.jobStartTime" class="txt-warm-grey gotham-medium font-14 font-weight-500">Add</span>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey gotham-medium font-14 margin-padding-zero">JOB END DATE</p>
            <p *ngIf="ticket.jobEndDate" class="gotham-medium dark-grey margin-top-10 font-14 margin-bottom-3">
              {{ticket.jobEndDate | date:'dd MMM yyyy'}}</p>
            <span *ngIf="!ticket.jobEndDate" class="txt-warm-grey font-14 gotham-medium font-weight-500">Add</span>
          </ion-col>
          <ion-col>
            <p class="txt-slate-grey gotham-medium margin-padding-zero font-14">TIME</p>
            <p *ngIf="ticket.jobEndTime" class="gotham-medium dark-grey margin-top-10 margin-bottom-3 font-14">
              {{ticket.jobEndTime | date:'hh:mm a'}}</p>
            <span *ngIf="!ticket.jobEndTime" class="txt-warm-grey gotham-medium font-14 font-weight-500">Add</span>
          </ion-col>
        </ion-row>
      </div>
    </div>

    <div *ngSwitchCase="'ASSETS'" class="full-width max-available-height margin-top-5">
      <div class="ticket-assets-card" *ngFor="let asset of ticket.assets">
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium margin-bottom-0">ASSET ID</p>
            <p class="margin-top-10 font-14 margin-bottom-10 gotham-medium dark-grey">{{asset.assetId}}</p>
          </ion-col>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium margin-bottom-0">ASSET NAME</p>
            <p class="margin-bottom-10 font-14 margin-top-10 gotham-medium dark-grey">{{asset.name}}</p>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium margin-padding-zero">LOCATION</p>
            <p class="margin-bottom-10 margin-top-10 font-14 gotham-medium dark-grey ">
              {{asset.location || "Not available"}}</p>
          </ion-col>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium margin-padding-zero">FLOOR</p>
            <p class="margin-bottom-0 margin-top-10 font-14 gotham-medium dark-grey">{{asset.floor || "Not available"}}
            </p>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <p class="txt-slate-grey font-14 gotham-medium margin-padding-zero">DESCRIPTION</p>
            <p class=" font-14 margin-bottom-0 margin-top-10 gotham-medium dark-grey">
              {{asset.description || "Not available"}}</p>
          </ion-col>
        </ion-row>
      </div>
      <br>
      <ion-row [hidden]="ticket.assets?.length > 0"
        class="txt-small txt-brown gotham-medium font-14 center-text margin-top-15">
        <ion-col>
          No Assets attached to this ticket
        </ion-col>
      </ion-row>

    </div>

    <div *ngSwitchCase="'COMMENTS'" class="full-width max-available-height">
      <ion-row class="padding-10 ">
        <ion-col>
          <textarea rows="7" class="border-grey-1 font-14 full-width " placeholder="Type your comment here"
            [(ngModel)]="ticket.commentText">
          </textarea>
          <ion-button class="float-right" style="margin: 5px; padding: 0">
            <p class="gotham font-14 margin-padding-zero" (click)="createComment()">Comment</p>
          </ion-button>
        </ion-col>
      </ion-row>
      <!-- Tickets comments section -->

      <ion-row [hidden]="comments?.length > 0"
        class="txt-small txt-brown gotham-medium center-text font-14 center margin-top-15">
        <ion-col>No comments found</ion-col>
      </ion-row>

      <ion-row *ngFor="let comment of comments" class="discussion-comment padding-5"
        style="margin-bottom:5px !important;">
        <!-- avatar -->
        <ion-col size="2" class="padding-10">
          <ion-row>
            <ngx-avatar class="gotham-medium" name="{{comment.createdBy.firstName}}"></ngx-avatar>
          </ion-row>
        </ion-col>
        <!-- content -->

        <ion-col size="9" class="padding-10">
          <ion-row>
            <ion-col class="  margin-bottom-0 padding-bottom-0">
              <ion-row class=" font-14 dark-grey gotham-medium">
                {{comment.createdBy.firstName}} {{comment.createdBy.lastName}}
              </ion-row>
              <ion-row>
                <p
                  class="font-14 txt-align-right gotham-medium txt-warm-grey font-14 margin-bottom-0 padding-bottom-0 margin-top-8">
                  {{comment.text}}</p>
              </ion-row>
            </ion-col>
            <ion-row
              class="font-14 txt-align-right gotham-medium txt-warm-grey font-14 margin-bottom-0 padding-bottom-0">
              {{comment.createdAt|date:'dd MMM yyyy'|agoFilter}}
            </ion-row>
          </ion-row>
        </ion-col>
        <br />
        <br />
        <br />
      </ion-row>
    </div>

    <div *ngSwitchCase="'CHECKLIST'" class="full-width max-available-height margin-top-5">
      <div class="ticket-details-list" *ngIf="ticket.checklist.length > 0">
        <ion-list class="padding-bottom-0">

          <ion-item *ngFor="let data of ticket.checklist; let i = index">
            <ion-checkbox class="txt-warm-grey" [(ngModel)]="data.completed"
              (ionChange)="updateCheckList(data.completed, i)"></ion-checkbox>
            <ion-label class="margin-left-20 font-14  gotham item-text-wrap">
              {{data.name}}
            </ion-label>
          </ion-item>

        </ion-list>

      </div>
      <br>
      <ion-row *ngIf="ticket.checklist?.length == 0"
        class="txt-small txt-brown gotham-medium font-14 center-text margin-top-15">
        <ion-col>
          No checklist found found
        </ion-col>
      </ion-row>
    </div>

    <div *ngSwitchCase="'QUOTATIONS'" class="full-width max-available-height margin-top-5">
      <div class="ticket-details-list" *ngIf="ticket.estimates.length > 0">
        <ion-list class="padding-0" *ngFor="let estimate of ticket.estimates">
          <ion-item>
            <ion-label>
              <ion-row>
                <ion-col>
                  <p class="gotham-medium font-14 dark-grey ">Quotation #{{estimate.referenceNumber}}</p>
                  <p class="gotham font-14 font-weight-600 txt-warm-grey ">
                    {{estimate.createdAt | date:'dd MMM yyyy'}}
                  </p>
                </ion-col>
                <ion-col class="padding-top-0">
                  <p class="gotham font-14 font-weight-600 float-right padding-right-10 txt-warm-grey">
                    {{estimate.totalAmount | currency:'INR'}}</p>
                </ion-col>
              </ion-row>
            </ion-label>
            <ion-note item-end style="align-self: center">
              <ion-icon name="ios-arrow-forward"></ion-icon>
            </ion-note>
          </ion-item>
        </ion-list>
      </div>
      <br>
      <ion-row *ngIf="ticket.estimates?.length == 0"
        class="txt-small txt-brown gotham-medium font-14 center-text margin-top-15">
        <ion-col>
          No estimate found
        </ion-col>
      </ion-row>
    </div>

    <div *ngSwitchCase="'MATERIALS'" class="full-width max-available-height margin-top-5">
      <div *ngIf="activeMaterialSection == 'description'" class="ticket-details-list full-width">
        <ion-row class="margin-0 padding-top-5 border-bottom-grey-1"
          *ngFor="let item of ticket.itemDetails let i = index">
          <ion-col size="1" class="margin-left-8">
            <p class="gotham-medium font-14 dark-grey margin-padding-zero">{{i+1}}</p>
          </ion-col>
          <ion-col size="8" class="margin-left-10">
            <p class="gotham-medium font-14 dark-grey margin-padding-zero">{{item.product.name}}</p>
            <p *ngIf="item.borneByEndUser"
              class="txt-warm-grey font-14 gotham-medium margin-bottom-0 font-weight-500 margin-top-8 txt-nowrap">
              Borne by customer
            </p>
            <p class="txt-warm-grey font-14 gotham-medium margin-top-8  font-weight-500txt-nowrap">
              Quantity : {{item.quantity}}
            </p>
          </ion-col>
          <ion-col class="margin-right-10 margin-top-3 padding-top-0">
            <img class="icon-25 float-right" src="assets/icon/delete.png">
          </ion-col>
        </ion-row>
      </div>

      <div *ngIf="activeMaterialSection == 'materialForm'">
        <div class="padding-25">
          <ion-list>
            <ion-list-header class="gotham font-16 font-weight-500">Material</ion-list-header>
            <ion-item>
              <ion-input inputmode="text" [(ngModel)]="materialData.name" class="gotham"
                placeholder="Clicke here to select material" (click)="openMaterialSearchModal()">
              </ion-input>
              <ion-icon class="float-right" name="arrow-dropdown"></ion-icon>
            </ion-item>
          </ion-list>
          <ion-list>
            <ion-list-header class="gotham font-16 font-weight-500">Enter quantity</ion-list-header>
            <ion-item>
              <ion-input inputmode="number" [(ngModel)]="materialData.quantity" class="gotham"
                placeholder="Enter quantity">
              </ion-input>
            </ion-item>
          </ion-list>
          <!-- <ion-list no-lines> -->
          <ion-item lines="none">
            <ion-label>Borne by customer?</ion-label>
            <ion-checkbox slot="start" [(ngModel)]="materialData.borneByEndUser"></ion-checkbox>
          </ion-item>
          <!-- </ion-list> -->

          <ion-row class="center-text">
            <ion-col>
              <ion-button (click)="hideMaterialForm()" color="danger" class="full-width">Cancel</ion-button>
            </ion-col>
            <ion-col>
              <ion-button color="success" class="full-width" (click)="tagMaterial()">Add</ion-button>
            </ion-col>
          </ion-row>

        </div>
      </div>

      <br>
      <ion-row *ngIf="ticket.itemDetails?.length == 0"
        class="txt-small center-text txt-brown gotham-medium font-14 margin-top-15">
        <ion-col>No materials found</ion-col>
      </ion-row>

      <ion-row class=" float-right margin-top-15" (click)="showMaterialForm()"
        *ngIf="activeMaterialSection == 'description'">
        <img src="assets/icon/add-green.png" class="height-30 width-30 border-radius-10 " />
        <p class="gotham-medium dark-grey margin-top-8 margin-left-5 margin-right-10 font-17 ">
          Add new
        </p>
      </ion-row>
    </div>

  </div>
</ion-content>